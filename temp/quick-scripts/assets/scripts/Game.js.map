{"version":3,"sources":["Game.js"],"names":["window","Global","bounceCount","cc","Class","extends","Component","properties","circleOpacity","gravityForce","bgOffset","normalPlanetWidth","minPlanetWidth","bg1","default","type","Node","bg2","bg3","bg4","wall","mars","earth","blackHole","scoreLabel","Label","failScoreLabel","singleScoreLabel","highScoreLabel","failScane","loginScane","guideScane","audio","circle","perfectBoomPrefab","Prefab","rankScane","rankingScrollView","Sprite","_setConstNum","node","height","onLoad","director","getCollisionManager","enabled","getPhysicsManager","gravity","v2","_updateUI","active","setOpacity","restart","start","tex","Texture2D","sharedCanvas","width","wx","postMessage","messageType","MAIN_MENU_NUM","failing","score","combo","getComponent","string","continue","singleScore","holeRadius","Math","random","holeIndex","floor","self","loader","loadRes","SpriteFrame","err","spriteFrame","setPosition","RigidBody","linearVelocity","on","EventType","TOUCH_START","onTouchBegan","TOUCH_MOVE","onTouchMove","TOUCH_CANCEL","onTouchEnd","TOUCH_END","fail","marsBegan","onContact","highScore","sys","localStorage","getItem","max","setItem","submitScore","getComponents","AudioSource","play","off","success","gap","border","abs","newStar","instantiate","addChild","position","scoreText","bounceScore","showScore","sequence","fadeIn","fadeOut","runAction","finished","callFunc","scale","angularVelocity","spawn","moveTo","scaleTo","event","fadeAction","stopPropagation","touchTime","Date","touchBagan","convertToNodeSpaceAR","touch","getLocation","stop","diffTime","getTime","min","rigidBody","center","getWorldCenter","vel","sub","normalizeSelf","mulSelf","getMass","divSelf","applyLinearImpulse","login","notVirgin","rankTapped","console","log","rankStartTapped","update","dt","updateBg","marsVel","x","y","vibrateShort","distance","sqrt","_updaetSubDomainCanvas","initWithElement","handleLoadedTexture","updateForce","marsBody","earthBody","holePosition","force","subSelf","applyForceToCenter","wallColliders","PhysicsBoxCollider","_setBound","_setViewFullScreen","maxSize","_setFrame","PhysicsCircleCollider","radius","offset","size"],"mappings":"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","file":"Game.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nwindow.Global = {\n    bounceCount: 0,\n};\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        circleOpacity: 60,\n        gravityForce: 10,\n        bgOffset:0,\n        normalPlanetWidth:0,\n        minPlanetWidth:0,\n\n        bg1: {\n            default: null,\n            type: cc.Node\n        },\n        bg2: {\n            default: null,\n            type: cc.Node\n        },\n        bg3: {\n            default: null,\n            type: cc.Node\n        },\n        bg4: {\n            default: null,\n            type: cc.Node\n        },\n        wall: {\n            default: null,\n            type: cc.Node\n        },\n        mars: {\n            default: null,\n            type: cc.Node\n        },\n        earth: {\n            default: null,\n            type: cc.Node\n        },\n        blackHole: {\n            default: null,\n            type: cc.Node\n        },\n        scoreLabel: {\n            default: null,\n            type: cc.Label\n        },\n        failScoreLabel: {\n            default: null,\n            type: cc.Label\n        },\n        singleScoreLabel: {\n            default: null,\n            type: cc.Node\n        },\n        highScoreLabel: {\n            default: null,\n            type: cc.Node\n        },\n        failScane: {\n            default: null,\n            type: cc.Node\n        },\n        loginScane: {\n            default: null,\n            type: cc.Node\n        },\n        guideScane: {\n            default: null,\n            type: cc.Node\n        },\n        audio: {\n            default: null,\n            type: cc.Node\n        },\n        circle: {\n            default: null,\n            type: cc.Node\n        },\n        perfectBoomPrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        rankScane: {\n            default: null,\n            type: cc.Node\n        },\n        rankingScrollView: cc.Sprite,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n    _setConstNum () {\n        this.normalPlanetWidth = this.node.height / 10;\n        this.minPlanetWidth = this.normalPlanetWidth * 0.8;\n    },\n\n    onLoad () {\n        cc.director.getCollisionManager().enabled = true;\n        cc.director.getPhysicsManager().enabled = true;\n        // 去除重力\n        cc.director.getPhysicsManager().gravity = cc.v2();\n        //常数设置\n        this._setConstNum();\n\n        //UI适配\n        this._updateUI();\n        this.guideScane.active = false;\n        this.rankScane.active = false;\n        \n        this.singleScoreLabel.setOpacity(0);\n        this.circle.setOpacity(0);\n\n        this.restart();\n    },\n\n    start() {\n        //     // this.tex = new cc.Texture2D();\n        //     // window.sharedCanvas.width = 720;\n        //     // window.sharedCanvas.height = 1280;\n        // this.tex = new cc.Texture2D();\n        // // this.rankTapped()\n\n        this.tex = new cc.Texture2D();\n        sharedCanvas.width = 720;\n        sharedCanvas.height = 1280;\n        wx.postMessage({\n            messageType: 1,\n            MAIN_MENU_NUM: \"x1\"\n        });\n    },\n\n    restart () {\n        this.failing = false;\n\n        //clear score\n        this.score = 0;\n        this.combo = 0;\n        this.scoreLabel.getComponent(cc.Label).string = '得分: ' + this.score;\n\n        this.continue();\n    },\n\n    continue () {\n        this.failScane.active = false;\n        this.singleScore = 0;\n\n        this.mars.active = true;\n\n        let width = this.node.width;\n        let height = this.node.height;\n\n        //科学难度\n        var holeRadius;\n        if (this.score <= 20) {\n            holeRadius = this.normalPlanetWidth * 2;\n        } else if (this.score <= 50) {\n            holeRadius = Math.random() * this.normalPlanetWidth / 2 + this.normalPlanetWidth * 1.5;\n        } else if (this.score <= 100) {\n            holeRadius = Math.random() * this.normalPlanetWidth / 2 + this.normalPlanetWidth;\n        } else {\n            holeRadius = Math.random() * this.normalPlanetWidth / 2 + this.normalPlanetWidth / 2;\n        }\n        this.blackHole.width = this.blackHole.height = holeRadius;\n        //重置黑洞\n        var holeIndex = Math.floor(Math.random() * 3) + 1;\n        this.blackHole.active = false;\t\n        var self = this;\n        cc.loader.loadRes('Goal' + holeIndex, cc.SpriteFrame, function (err, spriteFrame) {\t\n            self.blackHole.getComponent(cc.Sprite).spriteFrame = spriteFrame;\t\n            self.blackHole.active = true;\t\n        });\n        \n        this.mars.setPosition(Math.random() * width / 2 - width / 4, -height/3);\n        this.earth.setPosition(Math.random() * width / 2 - width / 4, Math.random() * height / 4 - height / 8);\n        this.blackHole.setPosition(Math.random() * width / 2 - width / 4, height / 3);\n        \n        this.mars.getComponent(cc.RigidBody).linearVelocity = cc.v2(0,0);\n        this.earth.getComponent(cc.RigidBody).linearVelocity = cc.v2(0,0);\n\n        //clear bounce count\n        Global.bounceCount = 0;\n\n        //恢复火星\n        this.mars.active = true;\n\n        //添加触摸监听\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchBegan, this);\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n    },\n\n    // Logic:\n    fail () {\n        // reset\n        this.failing = true;\n        this.marsBegan = false;\n        this.earth.onContact = false;\n\n        this.failScoreLabel.getComponent(cc.Label).string = this.score;\n\n        var highScore = cc.sys.localStorage.getItem('highScore');\n        highScore = Math.max(highScore, this.score);\n        cc.sys.localStorage.setItem('highScore', highScore);\n\n        this.highScoreLabel.getComponent(cc.Label).string = '历史最高分：' + highScore;\n        this.submitScore(highScore);\n\n        this.failScane.active = true;\n        \n        this.audio.getComponents(cc.AudioSource)[2].play();\n        //添加触摸监听\n        this.node.off(cc.Node.EventType.TOUCH_START, this.onTouchBegan, this);\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.off(cc.Node.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\n        this.node.off(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n    },//\n\n    success (gap) {\n        var border = Math.max(Math.abs(this.blackHole.width / 2 - this.earth.width / 2), this.earth.width / 2);\n        if (gap < border) {\n            //perfect\n            this.combo++;\n            this.singleScore = this.combo * 2;\n            this.score += this.singleScore;\n\n            this.audio.getComponents(cc.AudioSource)[4].play();\n        } else {\n            this.combo = 0;\n            this.singleScore = 1;\n            this.score++;\n            \n            this.audio.getComponents(cc.AudioSource)[3].play();\n        }\n\n        //动画\n        var newStar = cc.instantiate(this.perfectBoomPrefab);\n        // 将新增的节点添加到 Canvas 节点下面\n        this.node.addChild(newStar);\n        // 为星星设置一个随机位置\n        newStar.setPosition(this.blackHole.position);\n\n        //显示单次得分\n        this.singleScoreLabel.position = this.earth.position;\n        var scoreText = '';\n        if (this.combo > 0) {\n            scoreText = '完美';\n        } else {\n            scoreText = '命中';\n        }\n        scoreText += '  +' + this.singleScore;\n        var bounceScore = Global.bounceCount * (this.combo + 1);\n        this.score += bounceScore;\n        if (bounceScore > 0) {\n            scoreText += '\\n反弹  +' + bounceScore;\n        }\n        this.singleScoreLabel.getComponent(cc.Label).string = scoreText;\n        this.scoreLabel.getComponent(cc.Label).string = '得分: ' + this.score;\n        var showScore = cc.sequence(cc.fadeIn(0.1), cc.fadeOut(0.8));\n        this.singleScoreLabel.runAction(showScore);\n\n        //suck 吸入\n        var finished = cc.callFunc(function () {\n            this.earth.scale = 1;\n            this.earth.getComponent(cc.RigidBody).angularVelocity = 0;\n            this.continue();\n        }, this);\n        var spawn = cc.sequence(cc.spawn(cc.moveTo(0.2,this.blackHole.position), cc.scaleTo(0.2, 0)), finished);\n        this.earth.getComponent(cc.RigidBody).angularVelocity = 2000;\n        this.earth.runAction(spawn);\n    },\n\n    // Touch Event:\n    onTouchBegan (event) {\n        if (this.loginScane.active) {\n            return;\n        }\n\n        if (this.guideScane.active) {\n            var self = this;\n            var finished = cc.callFunc(function () {\n                self.guideScane.active = false;\n            }, this, 0);\n            var fadeAction = cc.sequence(cc.fadeOut(0.2), finished);\n            this.guideScane.runAction(fadeAction); \n\n            event.stopPropagation();\n            return;\n        }\n\n        if (this.marsBegan || !this.mars.active) return;\n\n        this.touchTime = new Date();\n        this.audio.getComponents(cc.AudioSource)[1].play();\n\n        this.touchBagan = true;\n        //展示圆圈\n        this.circle.setOpacity(this.circleOpacity);\n        this.onTouchMove(event);\n    },\n\n    onTouchMove (event) {\n        this.circle.setPosition(this.node.convertToNodeSpaceAR(cc.v2(event.touch.getLocation())));\n    },\n\n    onTouchEnd (event) {\n        if (this.marsBegan || !this.mars.active) return;\n\n        this.audio.getComponents(cc.AudioSource)[1].stop();\n\n        //时间毫秒差\n        var diffTime = (new Date().getTime() - this.touchTime.getTime());\n        diffTime = Math.min(diffTime, 3000);//最大3秒\n        diffTime = Math.max(diffTime, 500);//最小1秒\n\n        let rigidBody = this.mars.getComponent(cc.RigidBody);\n        let center = rigidBody.getWorldCenter();\n        //计算方向向量\n        var vel = cc.v2(event.touch.getLocation()).sub(center).normalizeSelf();\n        //乘以质量和最大初速度\n        vel = vel.mulSelf(rigidBody.getMass() * 7500);\n        //根据时间差调整力度\n        vel = vel.mulSelf(diffTime).divSelf(3000);\n        //实施动量\n        rigidBody.applyLinearImpulse(vel,rigidBody.getWorldCenter(),true);\n        //motion start\n        this.marsBegan = true;\n        //restore size\n        this.touchBagan = false;\n        this.mars.width = this.mars.height = this.normalPlanetWidth;\n        //圆圈消失\n        this.circle.setOpacity(0);\n    },\n\n    // Action:\n    login () {\n        this.loginScane.active = false;\n\n        var notVirgin = cc.sys.localStorage.getItem('notVirgin');\n        if (!notVirgin) {\n            cc.sys.localStorage.setItem('notVirgin', 1);\n            this.guideScane.active = true;\n        }\n    },\n\n    rankTapped () {\n        console.log('rank');\n        this.failScane.active = false\n        this.rankScane.active = true\n        // wx.postMessage({\n        //     message: 'Show'\n        // })\n        // this.tex = new cc.Texture2D();\n        // let openDataContext = wx.getOpenDataContext()\n        // console.log(openDataContext);\n        // openDataContext.postMessage({\n        //     text: 'hello'\n        // })\n    },\n\n    rankStartTapped () {\n        this.rankScane.active = false\n        this.restart()\n    },\n\n    submitScore (score){\n        wx.postMessage({\n            messageType: 3,\n            score: score\n        });\n    },\n\n    // Update:\n    update (dt) {\n        this.updateBg();\n\n        //失败界面只更新背景图\n        if (this.failing) {\n            return;\n        }\n\n        //模拟黑洞引力\n        //this.updateForce();\n\n        //蓄力缩小\n        if (this.touchBagan) {\n            if (this.mars.width > this.minPlanetWidth) {\n                this.mars.width -= 0.3;\n                this.mars.height -= 0.3;\n            }\n            \n            return;\n        }\n\n        //弹墙共15就算失败\n        if (Global.bounceCount >= 15) {\n            console.log(\"fail0\");\n            this.fail();\n            return;\n        }\n\n        //手松开，未碰到地球的情况下，火星停止了算失败\n        if (this.marsBegan && !this.earth.onContact) {\n            let marsVel = this.mars.getComponent(cc.RigidBody).linearVelocity;\n            if (Math.abs(marsVel.x) <= 0.5 && Math.abs(marsVel.y) <= 0.5) {\n                //运动停止\n                console.log(\"fail1\");\n                this.fail();\n                \n                return;\n            }\n        }\n\n        //碰到地球的情况\n        if (this.earth.onContact) {\n            if (this.mars.active) {\n                this.mars.getComponent(cc.RigidBody).linearVelocity = cc.v2(0,0);\n                this.mars.active = false;\n                this.marsBegan = false;\n\n                this.audio.getComponents(cc.AudioSource)[0].play();\n\n                wx.vibrateShort();\n            }\n\n            let vel = this.earth.getComponent(cc.RigidBody).linearVelocity;\n            //cc.log(vel);\n            if (Math.abs(vel.x) <= 0.5 && Math.abs(vel.y) <= 0.5) {\n                //运动停止\n                this.earth.onContact = false;\n                cc.log('stop');\n                //do sth ..\n                var distance = this.earth.position.sub(this.blackHole.position);\n                var gap = Math.sqrt(distance.x * distance.x + distance.y * distance.y);\n                if (gap <= (this.earth.width / 2 + this.blackHole.width / 2)) {\n                    this.success(gap);\n                } else {\n                    console.log(\"fail2\");\n                    this.fail();\n                }\n            }\n        }\n        this._updaetSubDomainCanvas();\n    },\n\n    // _updateSubDomainCanvas() {\n    //     if (!this.tex) {\n    //         return;\n    //     }\n    //     const sharedCanvas = wxapi.wxOpenData.wxGetSharedCanvas();\n    //     this.tex.initWithElement(sharedCanvas);\n    //     this.tex.handleLoadedTexture();\n    //     this.rankingScrollView.setTexture(this.tex);\n    //     this.rankingScrollView.spriteFrame = new cc.SpriteFrame(this.tex);\n    // },\n\n    _updaetSubDomainCanvas () {\n        // if (!this.tex) {\n        //     return;\n        // }\n        // this.tex.initWithElement(sharedCanvas);\n        // this.tex.handleLoadedTexture();\n        // this.rankDisplay.spriteFrame = new cc.SpriteFrame(this.tex);\n        this.tex.initWithElement(sharedCanvas);\n        this.tex.handleLoadedTexture();\n        this.rankingScrollView.spriteFrame = new cc.SpriteFrame(this.tex);\n    },\n\n    updateBg () {\n        let height = this.node.height;\n        this.bg1.setPosition(this.bg1.position.x + 1, this.bg1.position.y + 1);\n        this.bg2.setPosition(this.bg2.position.x + 1, this.bg2.position.y + 1);\n        this.bg3.setPosition(this.bg3.position.x + 1, this.bg3.position.y + 1);\n        this.bg4.setPosition(this.bg4.position.x + 1, this.bg4.position.y + 1);\n        \n        if (this.bgOffset < 0 && this.bg2.position.y >= 0) {\n            //高大于宽\n            this.bg1.setPosition(this.bgOffset, 0);\n            this.bg2.setPosition(this.bgOffset, -this.bg2.height);\n            this.bg3.setPosition(this.bgOffset - this.bg3.width, 0);\n            this.bg4.setPosition(this.bgOffset - this.bg4.width, -this.bg4.height);\n        }\n        if (this.bgOffset > 0 && this.bg3.position.x >= 0) {\n            //宽大于高\n            this.bg1.setPosition(0, -this.bgOffset);\n            this.bg2.setPosition(0, -this.bgOffset - this.bg2.height);\n            this.bg3.setPosition(-this.bg3.width, -this.bgOffset);\n            this.bg4.setPosition(-this.bg4.width, -this.bgOffset - this.bg4.height);\n        }\n    },\n\n    updateForce () {\n        let marsBody = this.mars.getComponent(cc.RigidBody);\n        let earthBody = this.earth.getComponent(cc.RigidBody);\n        let holePosition = this.blackHole.getComponent(cc.RigidBody).getWorldCenter();\n\n        var force = holePosition.subSelf(marsBody.getWorldCenter()).normalizeSelf().mulSelf(this.gravityForce * marsBody.getMass());\n        marsBody.applyForceToCenter(force);\n        force = holePosition.subSelf(earthBody.getWorldCenter()).normalizeSelf().mulSelf(this.gravityForce * earthBody.getMass());\n        earthBody.applyForceToCenter(force);\n    },\n\n    // UI Extension:\n    _updateUI () {\n        let width = this.node.width;\n        let height = this.node.height;\n\n        //适配墙壁\n        let wallColliders = this.wall.getComponents(cc.PhysicsBoxCollider);\n        this._setBound(wallColliders[0],-width/2,0,3,height);\n        this._setBound(wallColliders[1],width/2,0,3,height);\n\n        //适配三种场景\n        this._setViewFullScreen(this.loginScane);\n        this._setViewFullScreen(this.guideScane);\n        this._setViewFullScreen(this.failScane);\n        this._setViewFullScreen(this.rankScane);\n\n        //适配背景\n        var maxSize = Math.max(width, height);\n        //>0代表宽比高大，<0代表高比宽大\n        this.bgOffset = (width - height) / 2;\n        if (this.bgOffset > 0) {\n            this._setFrame(this.bg1, 0, -this.bgOffset, maxSize, maxSize);\n            this._setFrame(this.bg2, 0, -this.bgOffset - maxSize, maxSize, maxSize);\n            this._setFrame(this.bg3, -maxSize, -this.bgOffset, maxSize, maxSize);\n            this._setFrame(this.bg4, -maxSize, -this.bgOffset - maxSize, maxSize, maxSize);\n        } else {\n            this._setFrame(this.bg1, this.bgOffset, 0, maxSize, maxSize);\n            this._setFrame(this.bg2, this.bgOffset, -maxSize, maxSize, maxSize);\n            this._setFrame(this.bg3, this.bgOffset - maxSize, 0, maxSize, maxSize);\n            this._setFrame(this.bg4, this.bgOffset - maxSize, - maxSize, maxSize, maxSize);\n        }\n\n        //适配星球\n        this._setFrame(this.mars, 0, 0 , this.normalPlanetWidth, this.normalPlanetWidth);\n        this._setFrame(this.earth, 0, 0 , this.normalPlanetWidth, this.normalPlanetWidth);\n        this._setFrame(this.circle, 0, 0, this.normalPlanetWidth, this.normalPlanetWidth);\n        this.mars.getComponent(cc.PhysicsCircleCollider).radius = this.normalPlanetWidth / 2;\n        this.earth.getComponent(cc.PhysicsCircleCollider).radius = this.normalPlanetWidth / 2;\n    },\n\n    _setBound (node,x, y, width, height) {\n        node.offset.x = x;\n        node.offset.y = y;\n        node.size.width = width;\n        node.size.height = height;\n    },\n    _setViewFullScreen (node) {\n        this._setFrame(node, 0, 0, this.node.width, this.node.height);\n    },\n    _setFrame (node, x, y, width, height) {\n        node.x = x;\n        node.y = y;\n        node.width = width;\n        node.height = height;\n    },\n});\n"]}