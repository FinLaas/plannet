require=function n(c,a,h){function r(e,t){if(!a[e]){if(!c[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(l)return l(e,!0);var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}var o=a[e]={exports:{}};c[e][0].call(o.exports,function(t){return r(c[e][1][t]||t)},o,o.exports,n,c,a,h)}return a[e].exports}for(var l="function"==typeof require&&require,t=0;t<h.length;t++)r(h[t]);return r}({BlackHole:[function(t,e,i){"use strict";cc._RF.push(e,"f3db64D5NtCzK4s8yZNruFj","BlackHole"),cc.Class({extends:cc.Component,properties:{},start:function(){}}),cc._RF.pop()},{}],Game:[function(t,e,i){"use strict";cc._RF.push(e,"b64a6AdT6pHJ7IzuQfYpRDE","Game"),window.Global={bounceCount:0},cc.Class({extends:cc.Component,properties:{circleOpacity:60,gravityForce:10,bgOffset:0,normalPlanetWidth:0,minPlanetWidth:0,bg1:{default:null,type:cc.Node},bg2:{default:null,type:cc.Node},bg3:{default:null,type:cc.Node},bg4:{default:null,type:cc.Node},wall:{default:null,type:cc.Node},mars:{default:null,type:cc.Node},earth:{default:null,type:cc.Node},blackHole:{default:null,type:cc.Node},scoreLabel:{default:null,type:cc.Label},failScoreLabel:{default:null,type:cc.Label},singleScoreLabel:{default:null,type:cc.Node},highScoreLabel:{default:null,type:cc.Node},failScane:{default:null,type:cc.Node},loginScane:{default:null,type:cc.Node},guideScane:{default:null,type:cc.Node},audio:{default:null,type:cc.Node},circle:{default:null,type:cc.Node},perfectBoomPrefab:{default:null,type:cc.Prefab},rankScane:{default:null,type:cc.Node},rankingScrollView:cc.Sprite},_setConstNum:function(){this.normalPlanetWidth=this.node.height/10,this.minPlanetWidth=.8*this.normalPlanetWidth},onLoad:function(){cc.director.getCollisionManager().enabled=!0,cc.director.getPhysicsManager().enabled=!0,cc.director.getPhysicsManager().gravity=cc.v2(),this._setConstNum(),this._updateUI(),this.guideScane.active=!1,this.rankScane.active=!1,this.singleScoreLabel.setOpacity(0),this.circle.setOpacity(0),this.restart()},start:function(){this.tex=new cc.Texture2D,sharedCanvas.width=720,sharedCanvas.height=1280,wx.postMessage({messageType:1,MAIN_MENU_NUM:"x1"})},restart:function(){this.failing=!1,this.score=0,this.combo=0,this.scoreLabel.getComponent(cc.Label).string="得分: "+this.score,this.continue()},continue:function(){this.failScane.active=!1,this.singleScore=0,this.mars.active=!0;var t,e=this.node.width,i=this.node.height;t=this.score<=20?2*this.normalPlanetWidth:this.score<=50?Math.random()*this.normalPlanetWidth/2+1.5*this.normalPlanetWidth:this.score<=100?Math.random()*this.normalPlanetWidth/2+this.normalPlanetWidth:Math.random()*this.normalPlanetWidth/2+this.normalPlanetWidth/2,this.blackHole.width=this.blackHole.height=t;var s=Math.floor(3*Math.random())+1;this.blackHole.active=!1;var o=this;cc.loader.loadRes("Goal"+s,cc.SpriteFrame,function(t,e){o.blackHole.getComponent(cc.Sprite).spriteFrame=e,o.blackHole.active=!0}),this.mars.setPosition(Math.random()*e/2-e/4,-i/3),this.earth.setPosition(Math.random()*e/2-e/4,Math.random()*i/4-i/8),this.blackHole.setPosition(Math.random()*e/2-e/4,i/3),this.mars.getComponent(cc.RigidBody).linearVelocity=cc.v2(0,0),this.earth.getComponent(cc.RigidBody).linearVelocity=cc.v2(0,0),Global.bounceCount=0,this.mars.active=!0,this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},fail:function(){this.failing=!0,this.marsBegan=!1,this.earth.onContact=!1,this.failScoreLabel.getComponent(cc.Label).string=this.score;var t=cc.sys.localStorage.getItem("highScore");t=Math.max(t,this.score),cc.sys.localStorage.setItem("highScore",t),this.highScoreLabel.getComponent(cc.Label).string="历史最高分："+t,this.submitScore(t),this.failScane.active=!0,this.audio.getComponents(cc.AudioSource)[2].play(),this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},success:function(t){t<Math.max(Math.abs(this.blackHole.width/2-this.earth.width/2),this.earth.width/2)?(this.combo++,this.singleScore=2*this.combo,this.score+=this.singleScore,this.audio.getComponents(cc.AudioSource)[4].play()):(this.combo=0,this.singleScore=1,this.score++,this.audio.getComponents(cc.AudioSource)[3].play());var e=cc.instantiate(this.perfectBoomPrefab);this.node.addChild(e),e.setPosition(this.blackHole.position),this.singleScoreLabel.position=this.earth.position;var i="";i=0<this.combo?"完美":"命中",i+="  +"+this.singleScore;var s=Global.bounceCount*(this.combo+1);this.score+=s,0<s&&(i+="\n反弹  +"+s),this.singleScoreLabel.getComponent(cc.Label).string=i,this.scoreLabel.getComponent(cc.Label).string="得分: "+this.score;var o=cc.sequence(cc.fadeIn(.1),cc.fadeOut(.8));this.singleScoreLabel.runAction(o);var n=cc.callFunc(function(){this.earth.scale=1,this.earth.getComponent(cc.RigidBody).angularVelocity=0,this.continue()},this),c=cc.sequence(cc.spawn(cc.moveTo(.2,this.blackHole.position),cc.scaleTo(.2,0)),n);this.earth.getComponent(cc.RigidBody).angularVelocity=2e3,this.earth.runAction(c)},onTouchBegan:function(t){if(!this.loginScane.active){if(this.guideScane.active){var e=this,i=cc.callFunc(function(){e.guideScane.active=!1},this,0),s=cc.sequence(cc.fadeOut(.2),i);return this.guideScane.runAction(s),void t.stopPropagation()}!this.marsBegan&&this.mars.active&&(this.touchTime=new Date,this.audio.getComponents(cc.AudioSource)[1].play(),this.touchBagan=!0,this.circle.setOpacity(this.circleOpacity),this.onTouchMove(t))}},onTouchMove:function(t){this.circle.setPosition(this.node.convertToNodeSpaceAR(cc.v2(t.touch.getLocation())))},onTouchEnd:function(t){if(!this.marsBegan&&this.mars.active){this.audio.getComponents(cc.AudioSource)[1].stop();var e=(new Date).getTime()-this.touchTime.getTime();e=Math.min(e,3e3),e=Math.max(e,500);var i=this.mars.getComponent(cc.RigidBody),s=i.getWorldCenter(),o=cc.v2(t.touch.getLocation()).sub(s).normalizeSelf();o=(o=o.mulSelf(7500*i.getMass())).mulSelf(e).divSelf(3e3),i.applyLinearImpulse(o,i.getWorldCenter(),!0),this.marsBegan=!0,this.touchBagan=!1,this.mars.width=this.mars.height=this.normalPlanetWidth,this.circle.setOpacity(0)}},login:function(){this.loginScane.active=!1,cc.sys.localStorage.getItem("notVirgin")||(cc.sys.localStorage.setItem("notVirgin",1),this.guideScane.active=!0)},rankTapped:function(){console.log("rank"),this.failScane.active=!1,this.rankScane.active=!0},rankStartTapped:function(){this.rankScane.active=!1,this.restart()},submitScore:function(t){wx.postMessage({messageType:3,score:t})},update:function(t){if(this.updateBg(),!this.failing)if(this.touchBagan)this.mars.width>this.minPlanetWidth&&(this.mars.width-=.3,this.mars.height-=.3);else{if(15<=Global.bounceCount)return console.log("fail0"),void this.fail();if(this.marsBegan&&!this.earth.onContact){var e=this.mars.getComponent(cc.RigidBody).linearVelocity;if(Math.abs(e.x)<=.5&&Math.abs(e.y)<=.5)return console.log("fail1"),void this.fail()}if(this.earth.onContact){this.mars.active&&(this.mars.getComponent(cc.RigidBody).linearVelocity=cc.v2(0,0),this.mars.active=!1,this.marsBegan=!1,this.audio.getComponents(cc.AudioSource)[0].play(),wx.vibrateShort());var i=this.earth.getComponent(cc.RigidBody).linearVelocity;if(Math.abs(i.x)<=.5&&Math.abs(i.y)<=.5){this.earth.onContact=!1,cc.log("stop");var s=this.earth.position.sub(this.blackHole.position),o=Math.sqrt(s.x*s.x+s.y*s.y);o<=this.earth.width/2+this.blackHole.width/2?this.success(o):(console.log("fail2"),this.fail())}}this._updaetSubDomainCanvas()}},_updaetSubDomainCanvas:function(){this.tex.initWithElement(sharedCanvas),this.tex.handleLoadedTexture(),this.rankingScrollView.spriteFrame=new cc.SpriteFrame(this.tex)},updateBg:function(){this.node.height;this.bg1.setPosition(this.bg1.position.x+1,this.bg1.position.y+1),this.bg2.setPosition(this.bg2.position.x+1,this.bg2.position.y+1),this.bg3.setPosition(this.bg3.position.x+1,this.bg3.position.y+1),this.bg4.setPosition(this.bg4.position.x+1,this.bg4.position.y+1),this.bgOffset<0&&0<=this.bg2.position.y&&(this.bg1.setPosition(this.bgOffset,0),this.bg2.setPosition(this.bgOffset,-this.bg2.height),this.bg3.setPosition(this.bgOffset-this.bg3.width,0),this.bg4.setPosition(this.bgOffset-this.bg4.width,-this.bg4.height)),0<this.bgOffset&&0<=this.bg3.position.x&&(this.bg1.setPosition(0,-this.bgOffset),this.bg2.setPosition(0,-this.bgOffset-this.bg2.height),this.bg3.setPosition(-this.bg3.width,-this.bgOffset),this.bg4.setPosition(-this.bg4.width,-this.bgOffset-this.bg4.height))},updateForce:function(){var t=this.mars.getComponent(cc.RigidBody),e=this.earth.getComponent(cc.RigidBody),i=this.blackHole.getComponent(cc.RigidBody).getWorldCenter(),s=i.subSelf(t.getWorldCenter()).normalizeSelf().mulSelf(this.gravityForce*t.getMass());t.applyForceToCenter(s),s=i.subSelf(e.getWorldCenter()).normalizeSelf().mulSelf(this.gravityForce*e.getMass()),e.applyForceToCenter(s)},_updateUI:function(){var t=this.node.width,e=this.node.height,i=this.wall.getComponents(cc.PhysicsBoxCollider);this._setBound(i[0],-t/2,0,3,e),this._setBound(i[1],t/2,0,3,e),this._setViewFullScreen(this.loginScane),this._setViewFullScreen(this.guideScane),this._setViewFullScreen(this.failScane),this._setViewFullScreen(this.rankScane);var s=Math.max(t,e);this.bgOffset=(t-e)/2,0<this.bgOffset?(this._setFrame(this.bg1,0,-this.bgOffset,s,s),this._setFrame(this.bg2,0,-this.bgOffset-s,s,s),this._setFrame(this.bg3,-s,-this.bgOffset,s,s),this._setFrame(this.bg4,-s,-this.bgOffset-s,s,s)):(this._setFrame(this.bg1,this.bgOffset,0,s,s),this._setFrame(this.bg2,this.bgOffset,-s,s,s),this._setFrame(this.bg3,this.bgOffset-s,0,s,s),this._setFrame(this.bg4,this.bgOffset-s,-s,s,s)),this._setFrame(this.mars,0,0,this.normalPlanetWidth,this.normalPlanetWidth),this._setFrame(this.earth,0,0,this.normalPlanetWidth,this.normalPlanetWidth),this._setFrame(this.circle,0,0,this.normalPlanetWidth,this.normalPlanetWidth),this.mars.getComponent(cc.PhysicsCircleCollider).radius=this.normalPlanetWidth/2,this.earth.getComponent(cc.PhysicsCircleCollider).radius=this.normalPlanetWidth/2},_setBound:function(t,e,i,s,o){t.offset.x=e,t.offset.y=i,t.size.width=s,t.size.height=o},_setViewFullScreen:function(t){this._setFrame(t,0,0,this.node.width,this.node.height)},_setFrame:function(t,e,i,s,o){t.x=e,t.y=i,t.width=s,t.height=o}}),cc._RF.pop()},{}],Star:[function(t,e,i){"use strict";cc._RF.push(e,"1d5e1qmI1JHGbog57ACXkRm","Star"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.node.onContact=!1},onBeginContact:function(t,e,i){this.node.onContact=!0,console.log("contact"+Global.bounceCount),10<=i.tag&&(Global.bounceCount++,5==e.tag&&wx.vibrateShort())}}),cc._RF.pop()},{}]},{},["BlackHole","Game","Star"]);